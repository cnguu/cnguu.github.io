(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{543:function(t,s,a){"use strict";a.r(s);var n=a(37),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),a("p",[t._v("看下面一段代码：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"start"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"children2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    Promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"children3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"children4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"children5"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"children6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("result")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"children7"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br")])]),a("p",[t._v("打印结果：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("start\nchidlren4\nchidlren2\nchidlren3\nchidlren5\nchidlren7\nchidlren6\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("疑问：既然 Javascript 是单线程的，为什么不是从上到下的打印结果呢？")]),t._v(" "),a("h2",{attrs:{id:"浏览器内核是多线程的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器内核是多线程的"}},[t._v("#")]),t._v(" 浏览器内核是多线程的")]),t._v(" "),a("p",[t._v("虽然 Javascript 是单线程的，但是浏览器却不是，在内核控制下，各线程相互配合以保持同步，一个浏览器通常由以下常驻线程组成：")]),t._v(" "),a("ul",[a("li",[t._v("浏览器\n"),a("ul",[a("li",[t._v("浏览器进程")]),t._v(" "),a("li",[t._v("渲染进程\n"),a("ul",[a("li",[a("code",[t._v("Javascript 引擎线程")])]),t._v(" "),a("li",[a("code",[t._v("GUI 渲染线程")])]),t._v(" "),a("li",[a("code",[t._v("定时触发器线程")])]),t._v(" "),a("li",[a("code",[t._v("事件触发线程")])]),t._v(" "),a("li",[a("code",[t._v("异步 HTTP 请求线程")])])])]),t._v(" "),a("li",[t._v("GPU 进程")]),t._v(" "),a("li",[t._v("网络进程")]),t._v(" "),a("li",[t._v("插件进程")])])])]),t._v(" "),a("p",[a("code",[t._v("Javascript 引擎线程")]),t._v("称为主线程，其他可以称为辅助线程，这些辅助线程便是 Javascript 实现异步的关键")]),t._v(" "),a("h3",{attrs:{id:"javascript-引擎线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#javascript-引擎线程"}},[t._v("#")]),t._v(" Javascript 引擎线程")]),t._v(" "),a("p",[a("code",[t._v("Javascript 引擎")]),t._v("，也叫 Javascript 内核，主要负责处理 Javascript 脚本程序，解析 Javascript 脚本，运行代码，例如 V8 引擎")]),t._v(" "),a("h3",{attrs:{id:"gui-渲染线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gui-渲染线程"}},[t._v("#")]),t._v(" GUI 渲染线程")]),t._v(" "),a("p",[a("code",[t._v("GUI 渲染线程")]),t._v("，负责渲染浏览器界面，解析 HTML、CSS，构建 DOM 树和 RenderObject 树，布局和绘制等")]),t._v(" "),a("p",[t._v("当界面需要重绘(Repaint)或由于某种操作引发回流(reflow)时，该线程就会执行")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("Javascript 引擎线程")]),t._v("运行脚本期间，"),a("code",[t._v("GUI 渲染线程")]),t._v("都是处于挂起状态的，也就是说被“冻结”了")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("GUI 渲染线程")]),t._v("与"),a("code",[t._v("Javascript 引擎线程")]),t._v("互斥")]),t._v(" "),a("p",[t._v("由于 Javascript 是可操纵 DOM 的，如果在修改这些元素属性同时渲染界面（即"),a("code",[t._v("Javascript 引擎线程")]),t._v("和"),a("code",[t._v("GUI 渲染线程")]),t._v("同时运行），那么GUI 渲染前后获得的元素数据就可能不一致了；因此，为了防止渲染出现不可预期的结果，浏览器设置"),a("code",[t._v("GUI 渲染线程")]),t._v("与"),a("code",[t._v("Javascript 引擎线程")]),t._v("为互斥的关系，当"),a("code",[t._v("Javascript 引擎线程")]),t._v("执行时，"),a("code",[t._v("GUI 渲染线程")]),t._v("会被挂起，GUI 更新会被保存在一个队列中，等到"),a("code",[t._v("Javascript 引擎线程")]),t._v("空闲时立即被执行。")])]),t._v(" "),a("blockquote",[a("p",[t._v("Javascript 阻塞页面加载")]),t._v(" "),a("p",[t._v("由于"),a("code",[t._v("GUI 渲染线程")]),t._v("与"),a("code",[t._v("Javascript 引擎线程")]),t._v("是互斥的关系，当浏览器在执行 Javascript 程序的时候，"),a("code",[t._v("GUI 渲染线程")]),t._v("会被保存在一个队列中，直到 Javascript 程序执行完成，才会接着执行；因此，如果 Javascript 执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞的感觉。")])]),t._v(" "),a("h3",{attrs:{id:"定时触发器线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时触发器线程"}},[t._v("#")]),t._v(" 定时触发器线程")]),t._v(" "),a("p",[a("code",[t._v("setInterval")]),t._v("和"),a("code",[t._v("setTimeout")]),t._v("所在线程，避免"),a("code",[t._v("Javascript 引擎线程")]),t._v("处于阻塞线程状态影响计时的准确")]),t._v(" "),a("h3",{attrs:{id:"事件触发线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件触发线程"}},[t._v("#")]),t._v(" 事件触发线程")]),t._v(" "),a("p",[t._v("将满足触发条件的事件放入任务队列")]),t._v(" "),a("p",[t._v("当一个事件被触发时，"),a("code",[t._v("事件触发线程")]),t._v("会把事件添加到待处理队列的队尾，等待"),a("code",[t._v("Javascript 引擎线程")]),t._v("的处理；这些事件可以是当前执行的代码块，如定时任务，也可来自浏览器内核的其他线程，如鼠标点击、Ajax 异步请求等，但由于 Javascript 的单线程关系，所有这些事件都得排队，等待"),a("code",[t._v("Javascript 引擎线程")]),t._v("处理。")]),t._v(" "),a("h3",{attrs:{id:"异步-http-请求线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异步-http-请求线程"}},[t._v("#")]),t._v(" 异步 HTTP 请求线程")]),t._v(" "),a("p",[t._v("XMLHttpRequest 在连接后，通过浏览器新开一个线程请求，将检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件放到"),a("code",[t._v("Javascript 引擎线程")]),t._v("的处理队列中等待处理。")]),t._v(" "),a("h2",{attrs:{id:"任务队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#任务队列"}},[t._v("#")]),t._v(" 任务队列")]),t._v(" "),a("p",[t._v("任务队列，即事件循环(Event Loop)，Javascript 管理事件执行的一个流程")]),t._v(" "),a("p",[t._v("当任务加入到"),a("code",[t._v("任务队列")]),t._v("后并不会立即执行，而是处于等候状态，等主线程处理完了自己的事情后，才来执行"),a("code",[t._v("任务队列")]),t._v("中任务")]),t._v(" "),a("p",[t._v("任务又分为两种：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("宏任务")]),t._v("(MacroTask 或者 Task)\n"),a("ul",[a("li",[t._v("script")]),t._v(" "),a("li",[t._v("setInterval/setTimeout")]),t._v(" "),a("li",[t._v("setImmediate(NodeJS)")]),t._v(" "),a("li",[t._v("requestAnimationFrame")]),t._v(" "),a("li",[t._v("I/O")]),t._v(" "),a("li",[t._v("ajax")]),t._v(" "),a("li",[t._v("事件绑定")]),t._v(" "),a("li",[t._v("MessageChannel")]),t._v(" "),a("li",[t._v("postMessage")])])]),t._v(" "),a("li",[a("code",[t._v("微任务")]),t._v("(MicroTask)\n"),a("ul",[a("li",[t._v("UI rendering")]),t._v(" "),a("li",[t._v("Promise")]),t._v(" "),a("li",[t._v("process.nextTick(NodeJS)")]),t._v(" "),a("li",[t._v("Object.observe")]),t._v(" "),a("li",[t._v("MutationObserve")])])])]),t._v(" "),a("p",[a("code",[t._v("微任务")]),t._v("拥有更高的优先级，可以插队，当事件循环遍历队列时，先检查"),a("code",[t._v("微任务")]),t._v("队列，如果里面有任务，就全部拿来执行，执行完之后再执行一个"),a("code",[t._v("宏任务")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("ol",[a("li",[t._v("一个事件循环可以有一个或多个事件队列，但是只有一个"),a("code",[t._v("微任务")]),t._v("队列。")]),t._v(" "),a("li",[a("code",[t._v("微任务")]),t._v("队列全部执行完会重新渲染一次")]),t._v(" "),a("li",[t._v("每个"),a("code",[t._v("宏任务")]),t._v("执行完都会重新渲染一次")]),t._v(" "),a("li",[t._v("requestAnimationFrame 处于渲染阶段，不在"),a("code",[t._v("微任务")]),t._v("队列，也不在"),a("code",[t._v("宏任务")]),t._v("队列")])])]),t._v(" "),a("h2",{attrs:{id:"web-worker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web-worker"}},[t._v("#")]),t._v(" Web Worker")]),t._v(" "),a("p",[a("code",[t._v("Web Worker")]),t._v(" 能够同时执行两段 Javascript，不代表 Javascript 实现了多线程，"),a("code",[t._v("Web Worker")]),t._v(" 是向浏览器申请一个子线程，该子线程服务于主线程，完全受主线程控制")]),t._v(" "),a("ul",[a("li",[t._v("同源限制")]),t._v(" "),a("li",[t._v("DOM 限制")]),t._v(" "),a("li",[t._v("通信限制")]),t._v(" "),a("li",[t._v("脚本限制")]),t._v(" "),a("li",[t._v("文件限制")])]),t._v(" "),a("h3",{attrs:{id:"同源限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源限制"}},[t._v("#")]),t._v(" 同源限制")]),t._v(" "),a("p",[t._v("分配给 Worker 线程运行的脚本文件，必须和主线程的脚本文件同源")]),t._v(" "),a("h3",{attrs:{id:"dom-限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dom-限制"}},[t._v("#")]),t._v(" DOM 限制")]),t._v(" "),a("p",[t._v("Worker 线程所在的全局对象与主线程不一样，无法读取主线程所在网页的 DOM 对象，也无法使用 document、window、parent 这些对象，但是，Worker 线程可以使用 navigator 对象和 location 对象")]),t._v(" "),a("h3",{attrs:{id:"通信限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通信限制"}},[t._v("#")]),t._v(" 通信限制")]),t._v(" "),a("p",[t._v("Worker 线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过消息完成")]),t._v(" "),a("h3",{attrs:{id:"脚本限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本限制"}},[t._v("#")]),t._v(" 脚本限制")]),t._v(" "),a("p",[t._v("Worker 线程不能执行 alter 和 confirm 方法，但可以使用 XMLHttpRequest 对象发出 Ajax 请求")]),t._v(" "),a("h3",{attrs:{id:"文件限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件限制"}},[t._v("#")]),t._v(" 文件限制")]),t._v(" "),a("p",[t._v("Worker 线程无法读取本地文件，即不能打开本机的文件系统(file://)，它所加载的脚本必须来自网络")]),t._v(" "),a("h2",{attrs:{id:"最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[t._v("#")]),t._v(" 最后")]),t._v(" "),a("p",[t._v("回到前言，分析执行流程：")]),t._v(" "),a("ol",[a("li",[t._v("先执行"),a("code",[t._v("宏任务")]),t._v(" script 脚本")]),t._v(" "),a("li",[t._v("执行 "),a("code",[t._v('console.log("start")')])]),t._v(" "),a("li",[t._v("遇到定时器，交由"),a("code",[t._v("定时触发器线程")]),t._v("，等待时间到了加入队列")]),t._v(" "),a("li",[t._v("遇到 Promise 直接执行 executor，打印 "),a("code",[t._v('console.log("children4")')]),t._v("；遇到第二定时器，又交由"),a("code",[t._v("定时触发器线程")]),t._v("管理，等待加入队列；"),a("code",[t._v("Promise.then")]),t._v("等 resolve 之后加入微队列；此时，第一轮任务执行完毕")]),t._v(" "),a("li",[t._v("第一定时器先进入队列，取出任务执行 "),a("code",[t._v('console.log("children2")')]),t._v("，此时遇到 Promise 执行，并将 "),a("code",[t._v("Promise.then")]),t._v(" 放入当前宏任务队列中的微任务队列，当前任务执行完毕；执行 then，打印 "),a("code",[t._v('console.log("children3")')])]),t._v(" "),a("li",[t._v("取出第二定时器，打印 "),a("code",[t._v('console.log("children5")')]),t._v("，并将 then 放入微任务中，当前宏任务执行完毕，取出 then 执行打印 "),a("code",[t._v('console.log("children7")')])]),t._v(" "),a("li",[t._v("又遇到定时器，由"),a("code",[t._v("定时触发器线程")]),t._v("等待时间到了添加到宏任务中")]),t._v(" "),a("li",[t._v("取出定时器任务，打印 "),a("code",[t._v('console.log("children6")')])])])])}),[],!1,null,null,null);s.default=e.exports}}]);